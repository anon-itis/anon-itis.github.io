var app=angular.module("AnonITIS",["firebase"]);app.filter("reverse",function(){return function(e){return e?e.slice().reverse():void 0}}),app.value("fbURL","https://anon-itis.firebaseio.com/"),app.service("VK",[function(){return VK}]),app.service("Test",["$firebase","fbURL",function(e,n){var s=new Firebase(n+"test"),t=e(s).$asArray();return t}]),app.controller("MainCtrl",["$scope","VK","$interval","Test","$http",function(e,n,s,t,i){s(),t.$loaded(function(){e.test=t,e.authInfo=function(n){n.session&&(e.user=n.session.mid)},n.init({apiId:4726521}),n.Auth.getLoginStatus(e.authInfo),e.login=function(){n.Auth.login(e.authInfo)},e.logout=function(){n.Auth.logout(function(){e.user=!1})};var s={};e.users=function(e){return s[e]?s[e]:(s[e]=!0,void i.jsonp("https://api.vk.com/method/users.get?user_ids="+e+"&fields=photo_100&v=5.27&callback=JSON_CALLBACK ").success(function(n){n.response&&(s[e]=n.response[0])}))},e.isCheck=function(n,s){return-1===(n[0===s?"likes":"dislikes"]||[]).indexOf(0|e.user)?!1:!0},e.like=function(n,s,i){if(e.user){if(i>=0){var o=n;n=n.comments[i]}var r=parseInt(e.user),u=(n[(s?"":"dis")+"likes"]||[]).indexOf(r);-1!==u&&n[(s?"":"dis")+"likes"].splice(u,1),n[(s?"dis":"")+"likes"]?(u=(n[(s?"dis":"")+"likes"]||[]).indexOf(r),-1!==u?n[(s?"dis":"")+"likes"].splice(u,1):n[(s?"dis":"")+"likes"].push(r)):n[(s?"dis":"")+"likes"]=[r],i>=0&&(o.comments[i]=n,n=o),t.$save(n)}},e.x=!0,e.log=function(n){e.x&&console.log(n),e.x=!1},e.newPostAnon=!0,e.sendPost=function(){t.$add({owner:parseInt(e.user),anon:e.newPostAnon?1:0,text:e.newPost.toString().replace(/ +/g," "),date:Math.round((new Date).getTime()/1e3)}),e.newPost=""},e.comText={},e.comAnon={},e.sendComment=function(n){var s={owner:parseInt(e.user),anon:e.comAnon[n]?1:0,text:e.comText[n],date:Math.round((new Date).getTime()/1e3)},i=t.$getRecord(n);i.comments?i.comments.push(s):i.comments=[s],t.$save(i),e.comText[n]=""}})}]);